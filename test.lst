     1                                  [BITS 16]
     2 00000000 B8C007                  mov ax,0x07c0
     3 00000003 8ED8                    mov ds,ax
     4                                  
     5                                  
     6                                  enumerate:
     7 00000005 803E[6400]1F            	cmp byte [device_no],0x1F
     8 0000000A 7441                    	je increment_bus_no
     9 0000000C 803E[6300]FF            	cmp byte [bus_no],0xFF
    10 00000011 7446                    	je end
    11 00000013 66B800000000            	mov eax,0
    12 00000019 0A06[6300]              	or al,[bus_no]
    13 0000001D 66C1E005                	shl eax,5
    14 00000021 0A06[6400]              	or al,[device_no]
    15 00000025 66C1E00B                	shl eax,11
    16 00000029 660D00000080            	or eax,0x80000000
    17                                  
    18 0000002F 8B16[5F00]              	mov dx,[CONFIG_ADDRESS]
    19 00000033 66EF                    	out dx,eax
    20 00000035 8B16[6100]              	mov dx,[CONFIG_DATA]
    21 00000039 66ED                    	in eax,dx
    22 0000003B 8006[6400]01            	add byte [device_no],1
    23 00000040 6683F8FF                	cmp eax,0xFFFFFFFF
    24 00000044 74BF                    	je enumerate
    25                                  increment:
    26 00000046 8006[6500]01            	add byte [device_count],1
    27 0000004B EBB8                    	jmp enumerate
    28                                  increment_bus_no:
    29 0000004D 8006[6300]01            	add byte [bus_no],1
    30 00000052 C606[6400]00            	mov byte [device_no],0
    31 00000057 EBAC                    	jmp enumerate
    32                                  
    33                                  end:
    34 00000059 66A1[6500]              	mov dword eax,[device_count]
    35 0000005D EBFA                    	jmp end
    36                                  
    37                                  
    38                                  	
    39                                  
    40 0000005F F80C                    CONFIG_ADDRESS dw 0x0CF8
    41 00000061 FC0C                    CONFIG_DATA dw 0x0CFC
    42 00000063 FF                      bus_no db 0xFF
    43 00000064 1F                      device_no db 0x1F
    44 00000065 00                      device_count db 0x00
    45 00000066 00<rept>                times 510-($-$$) db 0x00
    46 000001FE 55                      db 0x55
    47 000001FF AA                      db 0xAA
